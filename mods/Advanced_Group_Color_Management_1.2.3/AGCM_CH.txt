##############################################################
## MOD Title: Advanced Group Color Management for CH 2.1.4
## MOD Author: Phantomk <phantomk@modmybb.com> (N/A) http://www.modmybb.com/
## MOD Description: Modify's the Group system to add colors.
## MOD Version: 1.2.3
##
## Installation Level: Advanced
## Installation Time: 60 Minutes
## Files To Edit: 31
##               admin/admin_caches.php
##               admin/admin_groups.php
##               admin/admin_users.php
##               admin/index.php
##               includes/class_forums.php
##               includes/class_stats.php
##               includes/class_topics.php
##               includes/class_user.php
##               includes/constants.php
##               includes/functions.php
##               includes/functions_search.php
##               includes/topic_review.php
##               includes/usercp_avatar.php
##               includes/usercp_register.php
##               includes/usercp_viewprofile.php
##               common.php
##               groupcp.php
##               memberlist.php
##               modcp.php
##               privmsg.php
##               search.php
##               viewonline.php
##               viewtopic.php
##               templates/subSilver/admin/index_body.tpl
##               templates/subSilver/admin/page_header.tpl
##               templates/subSilver/admin/user_edit_body.tpl
##               templates/subSilver/index_stats_box.tpl
##               templates/subSilver/overall_header.tpl
##               templates/subSilver/profile_add_body.tpl
##               templates/subSilver/subSilver.cfg
##               templates/subSilver/subSilver.css
## Included Files: 10
##               admin/admin_color.php
##               includes/class_color.php
##               language/lang_english/lang_admin_color.php
##               language/lang_english/lang_main_color.php
##               templates/subSilver/admin/color_edit_body.tpl
##               templates/subSilver/admin/color_style_select.tpl
##               templates/subSilver/images/arrow_down.gif
##               templates/subSilver/images/arrow_up.gif
##               templates/subSilver/search_color.tpl
##               templates/picker.js
##               install_color/*.*
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2
##############################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
##############################################################
## Author Notes:
##      - Inspired By Advanced Username Color by:
##         - aUsTiN <austin_inc@hotmail.com> (N/A) http://phpbb-amod.com/
##      - Tigra Color Picker provided by:
##         - SoftComplex <N/A> (N/A) http://www.softcomplex.com/
##      - Special thanks to ptirhiik for his time and patience in answering my barrage of questions.
##      - Thanks to Rabbit and No-L for the german translation.
##
##############################################################
## MOD History:
##
##   2006-1-24 - Version 1.2.3
##      - Added the ability to mass edit all styles in one go.
##      - Fixed a few minor things.
##
##   2006-1-9 - Version 1.2.2
##      - Added a version check to CH and Vanilla versions.
##
##   2006-1-4 - Version 1.2.1
##      - Made the install easier and more EasyMod compatiable.
##      - Fixed some minor bugs.
##
##   2005-12-12 - Version 1.2.0
##      - Fixed some errors with the user_session_time and user_group_id when a user is the guest.
##      - Added registered, inactive and anonymous colors to the legend.
##
##   2005-12-11 - Version 1.1.3
##      - Removed the session check from stat_last_user. (CH affected install only)
##      - Removed forum_last_user_group_id and forum_last user_session_time in replace of a query
##        which will now show the correct colors for the forum_last_user data. (CH affected install only)
##      - Fixed a typo in the install instructions for phpBB where thier was an instance of BEFORE
##        which should have been AFTER in a inline change.
##
##   2005-12-8 - Version 1.1.2
##      - Had a small miss spelling of the sync function, had 'all_forums' when it should have been
##        'all forums'.
##      - Added some features to the installer, such as a confirmation.
##      - Fixed a small error in the instructions where a fix was done in CH but not carried over
##        to phpBB. (Thanks to Dr.Death)
##
##   2005-12-5 - Version 1.1.1
##      - Fixed a small issue in the installer.
##      - Made a small change to functions_admin to help in resyncing topics.
##      - Added the sync() function to admin_colors, groupcp and class_colors to help with the cache.
##
##   2005-12-3 - Version 1.1.0
##      - Cleaned up the install instructions.
##      - Modified some instructions so that get_user_color is always called.
##      - Upgraded the installer to handle the upgrade process for pre 1.1.0
##      - Changed the theme field for storeing group colors from 'groupX' to 'gx'.
##      - Added a non-existant group for the anonymous user which will allow admin's to define a
##        color for any anonymous user.
##      - Completely modified the get_user_color function to handle user_session_time,
##        the users color will now change if they have not been online for a admin defined time.
##        This option can be disabled and the time period changed in the AGCM panel.
##      - Added a new css definition for "username_color" which will now allow more control for
##        template authors to alter how the username is displayed.
##
##   2005-11-21 - Version 1.0.3
##      - Cleaned up admin interface.
##      - Added colors to modcp.php
##      - 3 minor versions were done under 1.0.3 which were bug fixes for the install process.
##
##   2005-11-17 - Version 1.0.2
##      - Removed SQL from install, caused too many problems.
##      - Fixed a language bug.
##      - Added missing colors to privmsg.php preview.
##
##   2005-11-12 - Version 1.0.1
##      - Fixed installer issues.
##
##   2005-11-07 - Version 1.0.0
##      - Added group color's to admin/index.php and includes/topic_review.php
##      - Cleaned up installer
##      - Cleaned up Admin Interface
##      - Cleaned up some install find's and replace's
##      - Cleaned up popup window for tiagra color picker (Work's in FF, IE and Opera)
##      - Fixed a minor issue with other mod compatibility's in viewtopic.php
##      - Upgraded phpBB compatibility to 2.0.18
##      - Upgraded CH compatibility to 2.1.4
##
##   2005-10-04 - Version 0.2.2
##      - Fixed the install file, multiple errors
##      - Removed some code going into groupcp.php
##      - Modified install file for common.php
##
##   2005-10-03 - Version 0.2.1
##      - Added install file's
##         - Automatically installs the sql and updates the group tables, as well as regenerates
##           necessary cache for Cat Hierarchy
##
##   2005-09-29 - Version 0.2.0
##      - Bug Fixes and Code Cosmetic Changes (Thanks to Budman)
##      - Added admin_color.php to modify the color settings
##      - Added colors to the groupcp.php for the group name
##      - Added colors to the moderator list if the moderator is a group
##      - Added Tigra Color Picker (replaceing the Color Wheel)
##      - Added support for colors that are style specific
##
##   2005-09-22 - Version 0.1.0-RC2
##      - Bug Fixes
##
##   2005-09-12 - Version 0.1.0-RC1
##      - Changed legend link from groupcp to memberlist for Cat Hierarchy.
##      - Added support for sync function in functions_admin. (Fixes colors when a topic is deleted/split/moved in modcp)
##      - Modified the Legend to look like phpBB3 (Thanks to AJ Riddle)
##      - Added support for deleteing/adding users from/to a group or deleteing a group entirely in groupcp.php and admin_groups.php
##
##   2005-08-29 - Version 0.0.10-b
##      - Fixed colors not being displayed when viewing a forum or in search for Cat Hierarchy Install
##      - Fixed small find / replace in install instructions for Cat Hierarchy
##      - Fixed bug in ACP -> User Management
##      - Fixed bug in Vanilla phpBB where colors would not show up for non mod/admins in legend for whoisonline
##      - Fixed Auto Select bug in usercp_register.php
##      - Group_color_select now checks for pending.
##      - Both versions of install are now compatiable with EasyMod
##
##   2005-08-27 - Version 0.0.9-b
##      - Fixed markers for the install, as they created issues.  Shouldn't have anymore.
##      - Moved $colors->display_legend(); in page_header.php to index.php for Vanilla Installation
##      - Reformated class_colors.php fixing alot of bugs with the vanilla phpBB functions, and some minor CH functions.
##      - Fixed a missing class in search_color.tpl
##      - Fixed a problem with legend variable not changeing in ACP
##      - Updated Cat Hierarchy instructions to support 2.1.1RC6a, instructions are not to be used on 2.1.1RC5 as they are different in some areas
##      - Fixed alot of bugs with phpBB install
##
##   2005-08-26 - Version 0.0.8-b
##      - Fixed Color wheel, now functioning properly, I hope.
##      - Moved the colorwheel.png to the images folder. (Thanks to Cr@ter$)
##
##   2005-08-23 - Version 0.0.7-b
##      - Added markers to the install. (Thanks to Cr@ter$)
##      - Fixed a FIND in Cat Hierarchy install. (Thanks to Cr@ter$)
##      - Updated some missing code for search.php in Cat Hierarchy install.
##
##   2005-08-22 - Version 0.0.6-b
##      - Changed includes/class_stats.php install instructions for Cat Hierarchy.
##      - Redefined get_user_color function.
##
##   2005-08-22 - Version 0.0.5-b
##      - Minor Bug Fixes.
##      - Renamed phpbb_user field group_id to user_group_id.
##      - Fixed drop down user group menu issue when only in one group.
##
##   2005-08-21 - Version 0.0.4-b
##      - Cleaned up install txt's to reduce size.
##      - Moved code from top of files to common.php.
##
##   2005-08-21 - Version 0.0.3-b
##      - Second Beta Release.
##      - Added Vanilla phpBB Install.
##      - Minor Bug fixes.
##      - ACP User Management added.
##      - Known Bugs:
##          - Drop down box appears in profile/admin ACP even if only in one/no group('s).
##
##   2005-08-20 - Version 0.0.2-b
##      - First Beta Release.
##      - ACP Group Management Added.
##      - Profile Group Management, for users in multiple groups.
##      - Fully intergrated into Cat Hierarchy.
##      - Known Bugs:
##          - admin_user.php interface not completed.
##          - Drop down box appears in profile even if only in one group.
##
##   2005-08-16 - Version 0.0.1-b
##      - Initial Private Beta.
##
##############################################################
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
##############################################################

#
#-----[ COPY ]------------------------------------------------
#
copy root/admin/admin_color.php to admin/admin_color.php
copy root/includes/class_color.php to includes/class_color.php
copy root/language/lang_english/lang_admin_color.php to language/lang_english/lang_admin_color.php
copy root/language/lang_english/lang_main_color.php to language/lang_english/lang_main_color.php
copy root/templates/subSilver/admin/color_edit_body.tpl to templates/subSilver/admin/color_edit_body.tpl
copy root/templates/subSilver/admin/color_style_select.tpl to templates/subSilver/admin/color_style_select.tpl
copy root/templates/subSilver/images/arrow_down.gif to templates/subSilver/images/arrow_down.gif
copy root/templates/subSilver/images/arrow_up.gif to templates/subSilver/images/arrow_up.gif
copy root/templates/subSilver/search_color.tpl to templates/subSilver/search_color.tpl
copy root/templates/picker.js to templates/picker.js
copy root/install_color/*.* to install_color/*.*

#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_caches.php

#
#-----[ FIND ]------------------------------------------------
#
	'words' => 'words',

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	'colors' => 'colors',
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$result = $db->sql_query($sql, false, __LINE__, __FILE__);
			$config->set('stat_total_users', intval($db->sql_numrows($result)));
			$row = $db->sql_fetchrow($result);
			$config->set('stat_last_user', intval($row['user_id']));
			$config->set('stat_last_username', $row['username']);

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SELECT ', 'SELECT user_group_id, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$config->set('stat_last_user_group_id', $row['user_group_id']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	'stat_last_username' => array('type' => 'varchar', 'value' => $config->data['stat_last_username'], 'post_value' => '&nbsp;(' . $config->data['stat_total_users'] . '°)', 'output' => true, 'combined' => true),

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we replaced
//	'value' => $config->data['stat_last_username']
//-- with
//	'value' => $colors->get_user_color($config->data['stat_last_user_group_id'], '0', $config->data['stat_last_username'])
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
'value' => $config->data['stat_last_username']

#
#-----[ IN-LINE REPLACE WITH ]--------------------------------
#
'value' => $colors->get_user_color($config->data['stat_last_user_group_id'], '0', $config->data['stat_last_username'])

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_groups.php

#
#-----[ FIND ]------------------------------------------------
#
	//
	// Ok, they are submitting a group, let's save the data based on if it's new or editing
	//

#
#-----[ BEFORE, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	// Read the users in the specified group
	$colors->read_group_users($group_id);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		$message = $lang['Deleted_group'] . '<br /><br />' . sprintf($lang['Click_return_groupsadmin'], '<a href="' . append_sid("admin_groups.$phpEx") . '">', '</a>') . '<br /><br />' . sprintf($lang['Click_return_admin_index'], '<a href="' . append_sid("index.$phpEx?pane=right") . '">', '</a>');

		message_die(GENERAL_MESSAGE, $message);

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		// reset the users in this group
		$colors->set_group_users($group_id, true);

		// Remove the column and do various tasks when removeing a group
		$colors->remove_group($group_id);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			// reset the users mod status
			$moderators = new moderators();
			$moderators->set_users_status();
			unset($moderators);
//-- fin mod : categories hierarchy --------------------------------------------

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			// reset the users in this group
			$colors->set_group_users($group_id);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			// reset the users mod status
			$moderators = new moderators();
			$moderators->set_users_status();
			unset($moderators);
//-- fin mod : categories hierarchy --------------------------------------------

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			// Add the column and do various tasks when adding a new group
			$colors->add_group($new_group_id);

			// reset the users in this group
			$colors->set_group_users($new_group_id);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_users.php

#
#-----[ FIND ]------------------------------------------------
#
		$user_lang = ( $HTTP_POST_VARS['language'] ) ? $HTTP_POST_VARS['language'] : $board_config['default_lang'];

#
#-----[	AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		$user_group_id = ( $HTTP_POST_VARS['user_group_id'] ) ? intval( $HTTP_POST_VARS['user_group_id'] ) : GROUP_REGISTERED;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			if( $result = $db->sql_query($sql) )
			{
				if( isset($rename_user) )

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SET ', 'SET user_group_id = ' . intval($user_group_id) . ', ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
					// recache moderators if any
					include_once($config->url('includes/class_forums'));
					$moderators = new moderators();
					$moderators->read(true);
				}
//-- fin mod : categories hierarchy --------------------------------------------

#
#-----[	AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
				if ($this_userdata['user_group_id'] != $user_group_id)
				{
					// update last user
					if (($user_id == $config->data['stat_last_user']) || empty($config->data['stat_last_username']))
					{
						$config->set('stat_last_user_group_id', stripslashes($user_group_id));
					}

					// recache moderators
					include_once($config->url('includes/class_forums'));
					$moderators = new moderators();
					$moderators->read(true);
				}
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		$user_lang = $this_userdata['user_lang'];

#
#-----[	AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		$user_group_id = $this_userdata['user_group_id'];
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$s_hidden_fields .= '<input type="hidden" name="language" value="' . $user_lang . '" />';

#
#-----[	AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$s_hidden_fields .= '<input type="hidden" name="user_group_id" value="' . $user_group_id .'" />';
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'LANGUAGE_SELECT' => language_select($user_lang),

#
#-----[	AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			'GROUP_COLOR_SELECT' => $colors->group_color_select('user_group_id', $user_group_id, $user_id),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'L_BOARD_LANGUAGE' => $lang['Board_lang'],

#
#-----[	AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			'L_GROUP_COLOR_SELECT' => $lang['AGCM_user_color'],
			'L_GROUP_COLOR_SELECT_EXPLAIN' => $lang['AGCM_user_color_explain'],
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
admin/index.php

#
#-----[ FIND ]------------------------------------------------
#
	if(!$result = $db->sql_query($sql))
	{
		message_die(GENERAL_ERROR, "Couldn't obtain regd user/online information.", "", __LINE__, __FILE__, $sql);
	}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT u.user_group_id, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
					$style = isset($user_levels[ $row['user_level'] ]) ? $user_levels[ $row['user_level'] ]['style'] : $user_levels[USER]['style'];
					$username = sprintf(($row['user_allow_viewonline'] ? (empty($style) ? '%s' : '<span' . $style . '>%s</span>') : '<i' . $style . '>%s</i>'), $row['username']);

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$style = isset($user_levels[ $row['user_level'] ]) ? $user_levels[ $row['user_level'] ]['style'] : $user_levels[USER]['style'];
//	$username = sprintf(($row['user_allow_viewonline'] ? (empty($style) ? '%s' : '<span' . $style . '>%s</span>') : '<i' . $style . '>%s</i>'), $row['username']);
//-- add
					$style = ' style="color : #' . $colors->get_user_color($onlinerow_reg[$i]['user_group_id'], $onlinerow_reg[$i]['user_session_time']) . ';"';
					$username = sprintf(($row['user_allow_viewonline'] ? (empty($style) ? '%s' : '<span' . $style . ' class="username_color">%s</span>') : '<i' . $style . ' class="username_color">%s</i>'), $row['username']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	$template->assign_vars(array(
		'VERSION_INFO'	=> $version_info,
		'L_VERSION_INFORMATION'	=> $lang['Version_information'])
	);

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$errno = 0;
	$errstr = '';
	$available_mods = $mods_info = '';
	$count_installed_mods = count($installed_mods);

	if ($fsock = @fsockopen('www.modmybb.com', 80, $errno, $errstr, 10))
	{
		@fputs($fsock, "GET /mods.txt HTTP/1.1\r\n");
		@fputs($fsock, "HOST: www.modmybb.com\r\n");
		@fputs($fsock, "Connection: close\r\n\r\n");

		$get_info = false;

		while (!@feof($fsock))
		{
			if ($get_info)
			{
				$available_mods .= @fread($fsock, 1024);
			}
			else
			{
				if (@fgets($fsock, 1024) == "\r\n")
				{
					$get_info = true;
				}
			}
		}

		@fclose($fsock);

		$available_mods = explode("\n", $available_mods);
		$count_available_mods = count($available_mods);

		for ( $x = 0; $x < $count_installed_mods; $x++ )
		{
			for ( $i = 0; $i < $count_available_mods; $i++ )
			{
				$str = trim(str_replace(array("\r", "\n"), array('', ''), $available_mods[$i]));
				$line = empty($str) ? array() : explode(':', $str);
				$mod_name = trim($line[0]);
				$mod_version = trim($line[1]);
				$check_installed = false;

				if ( !empty($mod_name) && !empty($mod_version) && $mod_name == $installed_mods[$x]['name'] )
				{
					$installed_mods[$x]['current'] = $mod_version;
					$check_installed = true;
				}

				if ( $installed_mods[$x]['installed'] == $installed_mods[$x]['current'] && $check_installed )
				{
					$name = $installed_mods[$x]['name'];
					$mods_info .= '<p style="color:green">' . sprintf($lang['mod_up_to_date'], $lang[$name]) . '</p>';
				}
				else if ( $installed_mods[$x]['installed'] != $installed_mods[$x]['current'] && $check_installed )
				{
					$name = $installed_mods[$x]['name'];
					$current = $installed_mods[$x]['current'];
					$installed = $installed_mods[$x]['installed'];
					$mods_info .= '<p style="color:red">' . sprintf($lang['mod_not_up_to_date'], $lang[$name]);
					$mods_info .= '<br />' . sprintf($lang['current_mod_version'], $current) . ' ' . sprintf($lang['installed_mod_version'], $installed) . '</p>';
				}
			}
		}
	}
	else
	{
		if ($errstr)
		{
			$mods_info = '<p style="color:red">' . sprintf($lang['Connect_socket_error'], $errstr) . '</p>';
		}
		else
		{
			$mods_info = '<p>' . $lang['Socket_functions_disabled'] . '</p>';
		}
	}

	$template->assign_vars(array(
		'MODS_INFO' => $mods_info,
		'L_MODS_VERSION_INFORMATION' => $lang['mod_version_information'])
	);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/class_forums.php

#
#-----[ FIND ]------------------------------------------------
#
	var $displayed;
	var $moderators;
	var $last_fields;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	var $user_ids;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	function display($forum_id=0)
	{

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	function display_color($forum_id=0)
	{
		global $user;

		$count_subs = count($this->data[$forum_id]['subs']);
		$this->user_ids = array();

		for ( $i = 0; $i < $count_subs; $i++ )
		{
			$cur_id = $this->data[$forum_id]['subs'][$i];

			$layer_type = $this->data[$cur_id]['forum_type'];

			switch ( $layer_type )
			{
				case POST_CAT_URL:
					$this->display_color_a_cat($cur_id);
					break;
				case POST_FORUM_URL:
					$this->display_color_a_forum($cur_id);
					break;
			}
		}
	}

	function display_color_a_cat($forum_id)
	{
		global $user;

		$count_subs = count($this->data[$forum_id]['subs']);

		for ( $i = 0; $i < $count_subs; $i++ )
		{
			$cur_id = $this->data[$forum_id]['subs'][$i];

			$layer_type = $this->data[$cur_id]['forum_type'];

			switch ( $layer_type )
			{
				case POST_CAT_URL:
				case POST_FORUM_URL:
					$this->display_color_a_forum($cur_id);
					break;
			}
		}
	}

	function display_color_a_forum($forum_id)
	{
		global $user;

		$last_post_data = $this->data[ $this->data[$forum_id]['sum_last_post_forum_id'] ]['last'];

		if ( !in_array($last_post_data['forum_last_poster'], array(0, ANONYMOUS)) && !isset($user->pool[ $last_post_data['forum_last_poster'] ]) )
		{
			$this->user_ids[ $last_post_data['forum_last_poster'] ] = true;
		}
	}
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		$page_header_sent = false;
		$block_header_sent = false;
		$block_header_type = '';

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		$this->display_color($forum_id);
		$user->read_pool($this->user_ids);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	function display_a_forum($forum_id, $with_header, &$moderators, $footer_only=false)
	{
		global $template, $config, $user;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
					$last_post_data['forum_last_poster'] = ANONYMOUS;
					$last_post_data['forum_last_username'] = $user->lang('Guest');
				}

#
#-----[ REPLACE WITH ]----------------------------------------
#
					$last_post_data['forum_last_poster'] = ANONYMOUS;
					$last_post_data['forum_last_username'] = $user->lang('Guest');
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	}
//-- add
					$user->pool[ ANONYMOUS ]['username'] = $user->lang('Guest');
				}
				else
				{
					$user->pool[ ANONYMOUS ]['username'] = $last_post_data['forum_last_username'];
				}

				$user->pool[ ANONYMOUS ]['user_group_id'] = '0';
				$user->pool[ ANONYMOUS ]['user_session_time'] = '0';
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				$tpl_fields += array(
					'U_LAST_TOPIC' => empty($last_post_data['forum_last_post_id']) ? '' : $config->url('viewtopic', array(POST_POST_URL => $last_post_data['forum_last_post_id']), true, $last_post_data['forum_last_post_id']),

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
				$usercolor = $colors->get_user_color($user->pool[ $last_post_data['forum_last_poster'] ]['user_group_id'], $user->pool[ $last_post_data['forum_last_poster'] ]['user_session_time'], $user->pool[ $last_post_data['forum_last_poster'] ]['username']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
					'LAST_POSTER' => $last_post_data['forum_last_username'],

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'LAST_POSTER' => $last_post_data['forum_last_username'],
//-- add
					'LAST_POSTER' => $usercolor,
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	function post_process(&$rows)
	{

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				$row = array('mod_type' => POST_USERS_URL, 'mod_id' => $rows[$i]['user_id'], 'mod_name' => $rows[$i]['username'], 'mod_system' => false);

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
				$row = $row + array('mod_user_group_id' => $rows[$i]['user_group_id'], 'mod_user_session_time' => $rows[$i]['user_session_time']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		$this->data = $db_cached->sql_query($sql, __LINE__, __FILE__, $force);
		$this->data_flag = true;
		$this->data_time = $db_cached->data_time;

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	function display($tpl_switch, $forum_id)
	{
		global $template, $config, $user;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
					'L_MOD' => $row['mod_system'] ? $user->lang($row['mod_name']) : $row['mod_name'],

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'L_MOD' => $row['mod_system'] ? $user->lang($row['mod_name']) : $row['mod_name'],
//-- add
					'L_MOD' => ($row['mod_type'] == POST_USERS_URL) ? $colors->get_user_color($row['mod_user_group_id'], $row['mod_user_session_time'], $row['mod_name']) : $colors->get_user_color($row['mod_id'], '0', ($row['mod_system'] ? $user->lang($row['mod_name']) : $row['mod_name'])),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/class_stats.php

#
#-----[ FIND ]------------------------------------------------
#
	function display($forum_id)
	{
		global $db, $config, $template, $user;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
							'STYLE' => isset($user_levels[ $row['user_level'] ]) ? $user_levels[ $row['user_level'] ]['style'] : $user_levels[USER]['style'],

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'STYLE' => isset($user_levels[ $row['user_level'] ]) ? $user_levels[ $row['user_level'] ]['style'] : $user_levels[USER]['style'],
//-- add
							'STYLE' => ' style="color : #' . $colors->get_user_color($row['user_group_id'], $row['user_session_time']) . ';" class="username_color"',
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		foreach ( $user_levels as $user_level => $level_data )
		{
			if ( !empty($level_data['legend']) )
			{
				$template->assign_block_vars('stats.legend', array(
					'U_LEVEL' => empty($level_data['link_pgm']) ? '' : $config->url($level_data['link_pgm'], $level_data['link_parms'], true),
					'LEVEL_NAME' => $user->lang($level_data['legend']),
					'STYLE' => $level_data['style'],
				));
				$template->set_switch('stats.legend.link', !empty($level_data['link_pgm']));
			}
		}

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	foreach ( $user_levels as $user_level => $level_data )
//	{
//		if ( !empty($level_data['legend']) )
//		{
//			$template->assign_block_vars('stats.legend', array(
//				'U_LEVEL' => empty($level_data['link_pgm']) ? '' : $config->url($level_data['link_pgm'], $level_data['link_parms'], true),
//				'LEVEL_NAME' => $user->lang($level_data['legend']),
//				'STYLE' => $level_data['style'],
//			));
//			$template->set_switch('stats.legend.link', !empty($level_data['link_pgm']));
//		}
//	}
//-- add
		$colors->display_legend();
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				$result = $db->sql_query($sql, false, __LINE__, __FILE__);
				$config->set('stat_total_users', intval($db->sql_numrows($result)));
				$row = $db->sql_fetchrow($result);
				$config->set('stat_last_user', intval($row['user_id']));
				$config->set('stat_last_username', $row['username']);

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
				$sql = str_replace('SELECT ', 'SELECT user_group_id, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
				$config->set('stat_last_user_group_id', $row['user_group_id']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$last_username = $config->data['stat_last_username'];

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$last_user_group_id = $config->data['stat_last_user_group_id'];
			$last_user_color = ' style="color : #' . $colors->get_user_color($last_user_group_id, '0') . ';" class="username_color"';
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$l_newest_user = empty($total_users) ? '' : sprintf($user->lang('Newest_user'), '<a href="' . $config->url('profile', array('mode' => 'viewprofile', POST_USERS_URL => $last_user_id), true) . '"' . $user_levels[USER]['style'] . ' title="' . $user->lang('Read_profile') . '">', $last_username, '</a>');

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we replaced
//	$user_levels[USER]['style']
//-- with
//	$last_user_color
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
$user_levels[USER]['style']

#
#-----[ IN-LINE REPLACE WITH ]--------------------------------
#
$last_user_color

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'L_VIEWONLINE' => $user->lang('Who_is_Online'),

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			'L_GROUP_LEGEND' => $user->lang('AGCM_legend'),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/class_topics.php

#
#-----[ FIND ]------------------------------------------------
#
	function display_a_topic($row, $header_title='', $with_nav=false)
	{
		global $template, $config, $user, $forums, $icons, $topics_attr;
		global $images;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$row['topic_first_username'] = $user->pool[ $row['topic_poster'] ]['username'];

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$row['topic_first_user_group_id'] = $user->pool[ $row['topic_poster'] ]['user_group_id'];
			$row['topic_first_user_session_time'] = $user->pool[ $row['topic_poster'] ]['user_session_time'];
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$row['topic_last_username'] = $user->pool[ $row['topic_last_poster'] ]['username'];

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$row['topic_last_user_group_id'] = $user->pool[ $row['topic_last_poster'] ]['user_group_id'];
			$row['topic_last_user_session_time'] = $user->pool[ $row['topic_last_poster'] ]['user_session_time'];
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		// send to template
		$template->assign_block_vars('topicrow', array(
			'L_HEADER_TITLE' => $user->lang($header_title),

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		if ( $row['topic_poster'] == ANONYMOUS )
		{
			$row['topic_first_user_group_id'] = '0';
			$row['topic_first_user_session_time'] = '0';
		}

		if ( $row['topic_last_poster'] == ANONYMOUS )
		{
			$row['topic_last_user_group_id'] = '0';
			$row['topic_last_user_session_time'] = '0';
		}
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'TOPIC_AUTHOR' => (empty($row['topic_first_username']) || ($row['topic_first_username'] == ANONYMOUS)) ? $user->lang('Guest') : $row['topic_first_username'],

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we replaced
//	$user->lang('Guest') : $row['topic_first_username'],
//-- with
//	$colors->get_user_color($row['topic_first_user_group_id'], '0', $user->lang('Guest')) : $colors->get_user_color($row['topic_first_user_group_id'], $row['topic_first_user_session_time'], $row['topic_first_username']),
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
$user->lang('Guest') : $row['topic_first_username'],

#
#-----[ IN-LINE REPLACE WITH ]--------------------------------
#
$colors->get_user_color($row['topic_first_user_group_id'], '0', $user->lang('Guest')) : $colors->get_user_color($row['topic_first_user_group_id'], $row['topic_first_user_session_time'], $row['topic_first_username']),

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'LAST_POST_AUTHOR' => $row['topic_moved_id'] ? '' : ((empty($row['topic_last_username']) || ($row['topic_last_username'] == ANONYMOUS)) ? $user->lang('Guest') : $row['topic_last_username']),

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we replaced
//	$user->lang('Guest') : $row['topic_last_username']),
//-- with
//	$colors->get_user_color($row['topic_last_user_group_id'], '0', $user->lang('Guest')) : $colors->get_user_color($row['topic_last_user_group_id'], $row['topic_last_user_session_time'], $row['topic_last_username'])),
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
$user->lang('Guest') : $row['topic_last_username']),

#
#-----[ IN-LINE REPLACE WITH ]--------------------------------
#
$colors->get_user_color($row['topic_last_user_group_id'], '0', $user->lang('Guest')) : $colors->get_user_color($row['topic_last_user_group_id'], $row['topic_last_user_session_time'], $row['topic_last_username'])),

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/class_user.php

#
#-----[ FIND ]------------------------------------------------
#
		return array(
			'username',

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			'user_group_id',
			'user_session_time',
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$result = $db->sql_query($sql, false, __LINE__, __FILE__);
			$config->set('stat_total_users', intval($db->sql_numrows($result)));
			$row = $db->sql_fetchrow($result);
			$config->set('stat_last_user', intval($row['user_id']));
			$config->set('stat_last_username', $row['username']);

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SELECT ', 'SELECT user_group_id, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$config->set('stat_last_user_group_id', $row['user_group_id']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		return array('user_id' => intval($config->data['stat_last_user']), 'username' => $config->data['stat_last_username']);

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we added
//	, 'user_group_id' => $config->data['stat_last_user_group_id']
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
, 'username' => $config->data['stat_last_username']

#
#-----[ IN-LINE AFTER, ADD ]----------------------------------
#
, 'user_group_id' => $config->data['stat_last_user_group_id']

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/constants.php

#
#-----[ FIND ]------------------------------------------------
#
define('POST_GROUPS_URL', 'g');

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
define('POST_STYLES_URL', 's');
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/functions.php

#
#-----[ FIND ]------------------------------------------------
#
			break;

		case 'postcount':

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SELECT ', 'SELECT user_group_id, user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	if ( $userdata['user_id'] != ANONYMOUS )
	{
		if ( !empty($userdata['user_lang']))
		{
			$board_config['default_lang'] = $userdata['user_lang'];
		}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	global $colors;

	$colors->default_lang = $board_config['default_lang'];
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		include($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_admin.' . $phpEx);
	}

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$colors->lang();
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	global $starttime;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/functions_search.php

#
#-----[ FIND ]------------------------------------------------
#
	global $starttime, $gen_simple_header;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
?>

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
function color_search()
{
	global $template, $lang, $theme;
	$page_title = $lang['AGCM_color_search'];

	$template->set_filenames(array(
		'search_color' => 'search_color.tpl')
	);

	$template->assign_vars(array(
		'L_WEB_SAFE' => $lang['AGCM_web_safe'],
		'L_WINDOWS_SYSTEM' => $lang['AGCM_windows_system'],
		'L_GREY_SCALE' => $lang['AGCM_grey_scale'],
		'L_MAC_OS' => $lang['AGCM_mac_os'],
		'PAGE_TITLE' => $page_title,
		'S_CONTENT_DIRECTION' => $lang['DIRECTION'],
		'S_CONTENT_ENCODING' => $lang['ENCODING'],
		'T_BODY_BGCOLOR' => '#'.$theme['body_bgcolor'])
	);

	$template->pparse('search_color');

	return;
}
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/topic_review.php

#
#-----[ FIND ]------------------------------------------------
#
	global $starttime;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	global $colors;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Could not obtain post/user information', '', __LINE__, __FILE__, $sql);
	}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				'POSTER_NAME' => $poster,

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management --------------------------------------
//-- delete
//	'POSTER_NAME' => $poster,
//-- add
				'POSTER_NAME' => $colors->get_user_color($row['user_group_id'], $row['user_session_time'], $poster),
//-- fin mod : Avanced Group Color Management ----------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_avatar.php

#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
function display_avatar_gallery(
{

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we added
//	, &$user_group_id
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
, &$language

#
#-----[ IN-LINE BEFORE, ADD ]---------------------------------
#
, &$user_group_id

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
	$params = array(

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$params = $params + array('user_group_id');
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_register.php

#
#-----[ FIND ]------------------------------------------------
#
	$user_style = ( isset($HTTP_POST_VARS['style']) ) ? intval($HTTP_POST_VARS['style']) : $board_config['default_style'];

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$user_group_id = (isset($HTTP_POST_VARS['user_group_id'])) ? intval($HTTP_POST_VARS['user_group_id']) : GROUP_REGISTERED;
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			if ( !($result = $db->sql_query($sql)) )
			{
				message_die(GENERAL_ERROR, 'Could not update users table', '', __LINE__, __FILE__, $sql);
			}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SET ', 'SET user_group_id = ' . intval($user_group_id) . ', ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				// recache moderators
				include_once($config->url('includes/class_forums'));
				$moderators = new moderators();
				$moderators->set_users_status();
				$moderators->read(true);
			}
//-- fin mod : categories hierarchy --------------------------------------------

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			if ($userdata['user_group_id'] != $user_group_id)
			{
				// update last user
				if (($user_id == $config->data['stat_last_user']) || empty($config->data['stat_last_username']))
				{
					$config->set('stat_last_user_group_id', stripslashes($user_group_id));
				}

				// recache moderators
				include_once($config->url('includes/class_forums'));
				$moderators = new moderators();
				$moderators->read(true);
			}
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			// update last user
			$config->set('stat_last_user', $user_id);
			$config->set('stat_last_username', stripslashes($username));

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
// add
			$config->set('stat_last_user_group_id', stripslashes($user_group_id));
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			$sql = "INSERT INTO " . USERS_TABLE . "
				VALUES (

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we added
//	, user_group_id
//	, '$user_group_id'
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
, user_lang

#
#-----[ IN-LINE AFTER, ADD ]----------------------------------
#
, user_group_id

#
#-----[ IN-LINE FIND ]----------------------------------------
#
, '" . str_replace("\'", "''", $user_lang) . "'

#
#-----[ IN-LINE AFTER, ADD ]----------------------------------
#
, '$user_group_id'

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	$user_style = $userdata['user_style'];
	$user_lang = $userdata['user_lang'];

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$user_group_id = $userdata['user_group_id'];
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full lines is longer
#
	display_avatar_gallery(

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we added
//	, $user_group_id
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
, $user_lang

#
#-----[ IN-LINE BEFORE, ADD ]---------------------------------
#
, $user_group_id

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		'LANGUAGE_SELECT' => language_select($user_lang, 'language'),

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		'GROUP_COLOR_SELECT' => $colors->group_color_select('user_group_id', $user_group_id),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		'L_BOARD_LANGUAGE' => $lang['Board_lang'],

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		'L_GROUP_COLOR_SELECT' => $lang['AGCM_user_color'],
		'L_GROUP_COLOR_SELECT_EXPLAIN' => $lang['AGCM_user_color_explain'],
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_viewprofile.php

#
#-----[ FIND ]------------------------------------------------
#
	'USERNAME' => $profiledata['username'],

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'USERNAME' => $profiledata['username'],
//-- add
	'USERNAME' => $colors->get_user_color($profiledata['user_group_id'], $profiledata['user_session_time'], $profiledata['username']),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	'L_VIEWING_PROFILE' => sprintf($lang['Viewing_user_profile'], $profiledata['username']),

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- here we replaced
//	$profiledata['username']
//-- with
//	$colors->get_user_color($profiledata['user_group_id'], $profiledata['user_session_time'], $profiledata['username'])
//-- modify

#
#-----[ IN-LINE FIND ]----------------------------------------
#
$profiledata['username']

#
#-----[ IN-LINE REPLACE WITH ]--------------------------------
#
$colors->get_user_color($profiledata['user_group_id'], $profiledata['user_session_time'], $profiledata['username'])

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
common.php

#
#-----[ FIND ]------------------------------------------------
#
if (file_exists('install') || file_exists('contrib'))
{
	message_die(GENERAL_MESSAGE, 'Please_remove_install_contrib');
}

#
#-----[ BEFORE, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
define('IN_CH', TRUE);
include($config->url('includes/class_color'));

//
// prepare colors class
//
$colors = new colors();

//
// let's run the install script
//
if ( !defined('IN_INSTALL') && $config->data['mod_advanced_group_color_management'] != AGCM_CURRENT_VERSION )
{
	header('Location: ./install_color/install.' . $phpEx . (empty($SID) ? '' : '?' . $SID));
	exit;
}

//
// People never read achievement messages after after having seen "Succesfull !", tss tss :)
//
if ( !defined('IN_INSTALL') && file_exists('install_color') )
{
	message_die(GENERAL_MESSAGE, 'Please ensure the install_color/ directory is deleted');
}

//
// read colors
//
if ( !defined('IN_INSTALL') )
{
	$colors->read();
}
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
groupcp.php

#
#-----[ FIND ]------------------------------------------------
#
//
// Default var values
//
$is_moderator = FALSE;

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
$colors->read_group_users($group_id);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		// set users mod status
		$moderators = new moderators();
		$moderators->set_users_status();
		unset($moderators);

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		$colors->set_group_users($group_id);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		}
		//
		// END approve or deny
		//

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$colors->set_group_users($group_id);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Error getting user list for group', '', __LINE__, __FILE__, $sql);
	}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT user_group_id, user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Error getting user list for group', '', __LINE__, __FILE__, $sql);
	}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Error getting user pending information', '', __LINE__, __FILE__, $sql);
	}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	$username = $group_moderator['username'];

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$username = $group_moderator['username'];
//-- add
	$username = $colors->get_user_color($group_moderator['user_group_id'], $group_moderator['user_session_time'], $group_moderator['username']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		'GROUP_NAME' => $group_info['group_name'],

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'GROUP_NAME' => $group_info['group_name'],
//-- add
		'GROUP_NAME' => $colors->get_user_color($group_info['group_id'], '0', $group_info['group_name']),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		$username = $group_members[$i]['username'];

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$username = $group_members[$i]['username'];
//-- add
		$username = $colors->get_user_color($group_members[$i]['user_group_id'], $group_members[$i]['user_session_time'], $group_members[$i]['username']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				$username = $modgroup_pending_list[$i]['username'];

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$username = $modgroup_pending_list[$i]['username'];
//-- add
				$username = $colors->get_user_color($modgroup_pending_list[$i]['user_group_id'], $modgroup_pending_list[$i]['user_session_time'], $modgroup_pending_list[$i]['username']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
memberlist.php

#
#-----[ FIND ]------------------------------------------------
#
if( !($result = $db->sql_query($sql)) )
{
	message_die(GENERAL_ERROR, 'Could not query users', '', __LINE__, __FILE__, $sql);
}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
$sql = str_replace('SELECT ', 'SELECT user_group_id, user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'USERNAME' => $username,

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'USERNAME' => $username,
//-- add
			'USERNAME' => $colors->get_user_color($row['user_group_id'], $row['user_session_time'], $username),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
modcp.php

#
#-----[ FIND ]------------------------------------------------
#
			if ( !($result = $db->sql_query($sql)) )
			{
				message_die(GENERAL_ERROR, 'Could not get topic/post information', '', __LINE__, __FILE__, $sql);
			}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
						'POSTER_NAME' => $poster,

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'POSTER_NAME' => $poster,
//-- add
						'POSTER_NAME' => $colors->get_user_color($postrow[$i]['user_group_id'], $postrow[$i]['user_session_time'], $poster),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		if ( !($result = $db->sql_query($sql)) )
		{
			message_die(GENERAL_ERROR, 'Could not get posters information based on IP', '', __LINE__, __FILE__, $sql);
		}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
		$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
					'USERNAME' => $username,

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'USERNAME' => $username,
//-- add
					'USERNAME' => $colors->get_user_color($row['user_group_id'], $row['user_session_time'], $username),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
privmsg.php

#
#-----[ FIND ]------------------------------------------------
#
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Could not query private message post information', '', __LINE__, __FILE__, $sql);
	}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT u.user_group_id AS user_group_id_1, u2.user_group_id AS user_group_id_2, u.user_session_time AS user_session_time_1, u2.user_session_time AS user_session_time_2, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	$username_from = $privmsg['username_1'];

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$username_from = $privmsg['username_1'];
//-- add
	$username_from = $colors->get_user_color($privmsg['user_group_id_1'], $privmsg['user_session_time_1'], $privmsg['username_1']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
	$username_to = $privmsg['username_2'];

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$username_to = $privmsg['username_2'];
//-- add
	$username_to = $colors->get_user_color($privmsg['user_group_id_2'], $privmsg['user_session_time_2'], $privmsg['username_2']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		$to_username = (isset($HTTP_POST_VARS['username']) ) ? trim(htmlspecialchars(stripslashes($HTTP_POST_VARS['username']))) : '';

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$to_username = (isset($HTTP_POST_VARS['username']) ) ? trim(htmlspecialchars(stripslashes($HTTP_POST_VARS['username']))) : '';
//-- add
		if (isset($HTTP_POST_VARS['username']))
		{
			$to_username = phpbb_clean_username($HTTP_POST_VARS['username']);

			$sql = "SELECT username, user_group_id, user_session_time
				FROM " . USERS_TABLE . "
				WHERE username = '" . str_replace("\'", "''", $to_username) . "'
					AND user_id <> " . ANONYMOUS;
			if ( !($result = $db->sql_query($sql)) )
			{
				$error = TRUE;
				$error_msg = $lang['No_such_user'];
			}

			if ( $row = $db->sql_fetchrow($result) )
			{
				$to_username = $row['username'];
				$to_user_group_id = $row['user_group_id'];
				$to_user_session_time = $row['user_session_time'];
			}
		}
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'MESSAGE_TO' => $to_username,

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'MESSAGE_TO' => $to_username,
//-- add
			'MESSAGE_TO' => $colors->get_user_color($to_user_group_id, $to_user_session_time, $to_username),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
			'MESSAGE_FROM' => $userdata['username'],

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	'MESSAGE_FROM' => $userdata['username'],
//-- add
			'MESSAGE_FROM' => $colors->get_user_color($userdata['user_group_id'], $userdata['user_session_time'], $userdata['username']),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
switch( $folder )
{

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		$msg_username = $row['username'];

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$msg_username = $row['username'];
//-- add
		$msg_username = $colors->get_user_color($row['user_group_id'], $row['user_session_time'], $row['username']);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
search.php

#
#-----[ FIND ]------------------------------------------------
#
if ( $mode == 'searchuser' )

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	if ( $mode == 'searchuser' )
//-- add
if ($mode == 'searchcolor')
{
	//
	// This handles the simple windowed user color
	//
	color_search();

	exit;
}
else if ($mode == 'searchuser')
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
		}
		else
		{
			$sql = "SELECT t.*

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
		}

		$per_page =

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
			$sql = str_replace('SELECT ', 'SELECT u.user_group_id as user_group_id_1, u2.user_group_id as user_group_id_2, u.user_session_time as user_session_time_1, u2.user_session_time as user_session_time_2, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				$poster .= ( $searchset[$i]['user_id'] != ANONYMOUS ) ? $searchset[$i]['username'] : ( ( $searchset[$i]['post_username'] != "" ) ? $searchset[$i]['post_username'] : $lang['Guest'] );

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$poster .= ( $searchset[$i]['user_id'] != ANONYMOUS ) ? $searchset[$i]['username'] : ( ( $searchset[$i]['post_username'] != "" ) ? $searchset[$i]['post_username'] : $lang['Guest'] );
//-- add
				$poster .= ( $searchset[$i]['user_id'] != ANONYMOUS ) ? $colors->get_user_color($searchset[$i]['user_group_id'], $searchset[$i]['user_session_time'], $searchset[$i]['username']) : ((!empty($searchset[$i]['post_username'])) ? $colors->get_user_color($searchset[$i]['user_group_id'], '0', $searchset[$i]['post_username']) : $colors->get_user_color($searchset[$i]['user_group_id'], '0', $lang['Guest']));
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
viewonline.php

#
#-----[ FIND ]------------------------------------------------
#
if ( !($result = $db->sql_query($sql)) )
{
	message_die(GENERAL_ERROR, 'Could not obtain regd user/online information', '', __LINE__, __FILE__, $sql);
}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
				$style = isset($user_levels[ $row['user_level'] ]) ? $user_levels[ $row['user_level'] ]['style'] : $user_levels[USER]['style'];
				$username = sprintf(($row['user_allow_viewonline'] ? (empty($style) ? '%s' : '<span' . $style . '>%s</span>') : '<i' . $style . '>%s</i>'), $row['username']);

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- delete
//	$style = isset($user_levels[ $row['user_level'] ]) ? $user_levels[ $row['user_level'] ]['style'] : $user_levels[USER]['style'];
//	$username = sprintf(($row['user_allow_viewonline'] ? (empty($style) ? '%s' : '<span' . $style . '>%s</span>') : '<i' . $style . '>%s</i>'), $row['username']);
//-- add
				$style = ' style="color : #' . $colors->get_user_color($row['user_group_id'], $row['user_session_time']) . ';"';
				$username = sprintf(($row['user_allow_viewonline'] ? (empty($style) ? '%s' : '<span' . $style . ' class="username_color">%s</span>') : '<i' . $style . ' class="username_color">%s</i>'), $username);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
viewtopic.php

#
#-----[ FIND ]------------------------------------------------
#
if ( !($result = $db->sql_query($sql)) )
{
	message_die(GENERAL_ERROR, "Could not obtain post/user information.", '', __LINE__, __FILE__, $sql);
}

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : Advanced Group Color Management -------------------------------------
//-- add
$sql = str_replace('SELECT ', 'SELECT u.user_group_id, u.user_session_time, ', $sql);
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ FIND ]------------------------------------------------
#
		'POSTER_NAME' => $poster,

#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Advanced Group Color Management --------------------------------------
//-- delete
//	'POSTER_NAME' => $poster,
//-- add
		'POSTER_NAME' => $colors->get_user_color($postrow[$i]['user_group_id'], $postrow[$i]['user_session_time'], $poster),
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/index_body.tpl

#
#-----[ FIND ]------------------------------------------------
#
<h1>{L_WHO_IS_ONLINE}</h1>

#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<h1>{L_MODS_VERSION_INFORMATION}</h1>
{MODS_INFO}
<br />

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/page_header.tpl

#
#-----[ FIND ]------------------------------------------------
#
<head>

#
#-----[ AFTER, ADD ]------------------------------------------
#
<!--
Title: Tigra Color Picker
URL: http://www.softcomplex.com/products/tigra_color_picker/
Version: 1.1
Date: 06/26/2003 (mm/dd/yyyy)
Note: Permission given to use this script in ANY kind of applications if
   header lines are left unchanged.
Note: Script consists of two files: picker.js and picker.html
-->
<script language=JavaScript src="../templates/picker.js"></script>

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/user_edit_body.tpl

#
#-----[ FIND ]------------------------------------------------
#
	<tr> 
	  <td class="row1"><span class="gen">{L_BOARD_STYLE}</span></td>
	  <td class="row2">{STYLE_SELECT}</td>
	</tr>

#
#-----[ AFTER, ADD ]------------------------------------------
#
	<!-- BEGIN group_color_select -->
	<tr>
		<td class="row1"><span class="gen">{L_GROUP_COLOR_SELECT}</span><br /><span class="gensmall">{L_GROUP_COLOR_SELECT_EXPLAIN}</span></td>
		<td class="row2">{GROUP_COLOR_SELECT}</td>
	</tr>
	<!-- END group_color_select -->

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/index_stats_box.tpl

#
#-----[ FIND ]------------------------------------------------
#
<span class="gensmall">{L_ONLINE_USERS}&nbsp;<!-- BEGIN root_ELSE -->{TOTAL_USERS_ONLINE}<br /><!-- END root_ELSE --><!-- BEGIN online --><!-- BEGIN sep -->, <!-- END sep --><a href="{stats.online.U_VIEW_PROFILE}" title="{L_VIEW_PROFILE}" class="gensmall" {stats.online.STYLE}>{stats.online.USERNAME}</a><!-- END online --><!-- BEGIN none -->{NO_USERS_ONLINE}<!-- END none -->

#
#-----[ IN-LINE FIND ]----------------------------------------
#
 class="gensmall" {stats.online.STYLE}

#
#-----[ IN-LINE REPLACE WITH ]--------------------------------
#
{stats.online.STYLE}

#
#-----[ FIND ]------------------------------------------------
#
{L_ONLINE_USERS}&nbsp;<!-- BEGIN online --><!-- BEGIN sep -->, <!-- END sep --><a href="{stats.past.online.U_VIEW_PROFILE}" title="{L_VIEW_PROFILE}" class="gensmall" {stats.past.online.STYLE}>{stats.past.online.USERNAME}</a><!-- END online --><!-- BEGIN none -->{NO_USERS_ONLINE}<!-- END none -->

#
#-----[ IN-LINE FIND ]----------------------------------------
#
 class="gensmall" {stats.past.online.STYLE}

#
#-----[ IN-LINE REPLACE WITH ]--------------------------------
#
{stats.past.online.STYLE}

#
#-----[ FIND ]------------------------------------------------
#
		<b>{L_LEGEND}:</b>&nbsp;<!-- BEGIN legend -->[&nbsp;<!-- BEGIN link --><a href="{stats.legend.U_LEVEL}" class="gensmall" {stats.legend.STYLE}><!-- BEGINELSE link --><span {stats.legend.STYLE}><!-- END link --><b>{stats.legend.LEVEL_NAME}</b><!-- BEGIN link --></a><!-- BEGINELSE link --></span><!-- END link -->&nbsp;]<!-- END legend -->

#
#-----[ REPLACE WITH ]----------------------------------------
#
			<b>{L_GROUP_LEGEND} 
			<!-- BEGIN legend -->
			<!-- BEGIN color -->
			<a href="{stats.legend.U_GROUP}" title="{stats.legend.GROUP_DESCRIPTION}"{stats.legend.GROUP_COLOR}>{stats.legend.GROUP_NAME}</a>{stats.legend.color.L_COMMA}
			<!-- END color -->
			<!-- END legend -->
			</b>

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/overall_header.tpl

#
#-----[ FIND ]------------------------------------------------
#
.helpline { background-color: {T_TR_COLOR2}; border-style: none; }

#
#-----[ AFTER, ADD ]------------------------------------------
#
.username_color { font-size : {T_FONTSIZE1}px; font-weight : bold; }
a.username_color { font-size : {T_FONTSIZE1}px; font-weight : bold; text-decoration : none; }
a.username_color:hover { font-size : {T_FONTSIZE1}px; font-weight : bold; color : {T_BODY_HLINK}; text-decoration : underline; }

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/profile_add_body.tpl

#
#-----[ FIND ]------------------------------------------------
#
	<tr>
		<td class="row1"><span class="gen">{L_BOARD_STYLE}:</span></td>
		<td class="row2"><span class="gensmall">{STYLE_SELECT}</span></td>
	</tr>

#
#-----[ AFTER, ADD ]------------------------------------------
#
	<!-- BEGIN group_color_select -->
	<tr>
		<td class="row1"><span class="gen">{L_GROUP_COLOR_SELECT}</span><br /><span class="gensmall">{L_GROUP_COLOR_SELECT_EXPLAIN}</span></td>
		<td class="row2">{GROUP_COLOR_SELECT}</td>
	</tr>
	<!-- END group_color_select -->

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/subSilver.cfg

#
#-----[ FIND ]------------------------------------------------
#
$current_template_images = $current_template_path . "/images";

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Advanced Group Color Management --------------------------------------
// add
$images['Down'] = $current_template_images . '/arrow_down.gif';
$images['Up'] = $current_template_images . '/arrow_up.gif';
//-- fin mod : Advanced Group Color Management ---------------------------------

#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/subSilver.css

#
#-----[ FIND ]------------------------------------------------
#
.helpline { background-color: #DEE3E7; border-style: none; }

#
#-----[ AFTER, ADD ]------------------------------------------
#
.username_color { font-size : 10px; font-weight : bold; }
a.username_color { font-size : 10px; font-weight : bold; text-decoration : none; }
a.username_color:hover { font-size : 10px; font-weight : bold; color : #DD6900; text-decoration : underline; }

#
#-----[ SAVE/CLOSE ALL FILES ]--------------------------------
#
# EoM