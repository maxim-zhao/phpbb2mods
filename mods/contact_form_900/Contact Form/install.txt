############################################################## 
## MOD Title:		Contact Form
## MOD Author:          marcus.smith < marcus@phobbia.net > (MarcuS) http://www.phobbia.net/mods/
## MOD Author:          darkassasin93 < N/A > (Matt Bowen) N/A
## MOD Description:	Allows visitors to contact the site Admin via a Contact Form.
##			Files can also be attached and sent if permitted.
## MOD Version:		9.0.0
##
## Installation Level:	Easy
##
## Installation Time:	~10 Minutes
##
## Files To Edit:  	view_online.php
##			admin/index.php
##			includes/page_header.php
## 		   	includes/constants.php
##		   	language/lang_english/lang_main.php
##		   	templates/subSilver/overall_header.tpl
##
## Included Files:	contact.php
##			db_update.php
##			admin/admin_contact.php
##			efiles/index.html
##			fonts/BauerBodoniItalicBT.ttf
##			fonts/OregonDry.ttf
##			fonts/VillageSquare.ttf
##			fonts/WarmMilk.ttf
##			fonts/index.html
##			images/captcha/captcha1.png
##			images/captcha/captcha2.png
##			images/captcha/captcha3.png
##			images/captcha/captcha4.png
##			images/captcha/captcha5.png
##			images/captcha/index.html
##			includes/contact_captcha.php
##			includes/functions_contact.php
##			language/lang_english/lang_contact.php
##			language/lang_english/email/contact.tpl
##			templates/subSilver/contact_body.tpl
##			template/subSilver/admin/contact_config_body.tpl
##			template/subSilver/admin/contact_msgs.tpl
##			template/subSilver/admin/contact_fullmsg.tpl
##			template/subSilver/images/icon_mini_contact.gif
##
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2 
##############################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
############################################################## 
## Author Notes:
##
##	Acknowledgements
##	----------------
##	This mod has been passed to myself for development by assasin93, with kind permission.
##	See: http://www.phpbb.com/community/viewtopic.php?f=16&t=278496 for information.
##	
##	Ban/Allow Extensions
##	--------------------
##	To add/remove extensions for your own form, simply OPEN contact.php,
##	then FIND the $blacklist and $whitelist arrays.  EDIT, with care, as required.
##	
##	CAPTCHA Requirements
##	--------------------
##	To be able to use the Coloured CAPTCHA, your PHP server requires PHP 4.3.0 and GD Library 2.0.1
##	or later. For the Image based CAPTCHA, your PHP server requires GD Library 1.6 or later to support
##	PNG. The GD2 Library requires "Freetype Support" installed for TTF's to be displayed (as of RC7).
##	If "Freetype Support" is not present, the CAPTCHA should display a PHP standard Font (as of RC9).
##
##	If the PNG Captcha Images are missing, the mod will attempt to use a Coloured type CAPTCHA.
##	If your GD Lib is does not support this, you will have to fix it due to errors...
##		But at least you won't have been spammed in the meantime! ;)
##
##	Languages Supported - See contrib
##	-------------------
##	Dutch	- by Dark Inca
##	French	- by Ram (phpbb-fr.com)
##	German	- by IPB_Refugee / Lefty74
##	Italian	- by Cavallino
##	Polish	- by Kastak
##	Spanish	- by 'Dogs and things'
##
##	Thanks to everyone who has translated this mod, so far!
##	If you'd like to provide a translation for a language not included here, please contact me.
##
##	Known Issues
##	------------
##	If you get the following PHP error:
##		Warning: ob_start() [ref.outcontrol]: output handler 'ob_gzhandler' cannot be used after 'URL-Rewriter'
##
##	Then you may have output_buffering set to "On" in your php.ini, and this causes the errors. If you cannot
##	set this to "Off" or prefer not to change the setting, then a simple fix can be found here:
##	--- Article missing since phpbb.com updated to a phpBB3 board ---
##
##############################################################
## MOD History:
##
##	2007-08-08 - Version 9.0.0
##		- Submitted to ModDB
##
##	2007-07-10 - Version 9.0.0 [RC8a]
##		- Corrected a bug in Dutch language file
##
##	2007-07-03 - Version 9.0.0 [RC8]
##		- Optimisation of Message Log code for faster results
##		- Reorganised and expanded black/whitelists for further security
##
##	2007-07-03 - Version 9.0.0 [RC7]
##		- Bug fix for file attachment path in e-mail notification
##		- File attach code shifted to a seperate file
##		- Additional extensions blacklisted
##		- Further code tweaks to improve file handling
##
##	2007-06-25 - Version 9.0.0 [RC6]
##		- Applied CAPTCHA fix when PHP version is less than 4.3.0 (due to use of glob() function)
##		- Additional code changes to improve file handling on various server settings
##		- Minor security fix
##
##	2007-06-22 - Version 9.0.0 [RC5]
##		- New Polish translation available
##
##	2007-06-20 - Version 9.0.0 [RC4]
##		- Changed SQL due to: "Identifier 'file' is a reserved keyword" issue to 'upfile'
##
##	2007-06-20 - Version 9.0.0 [RC3]
##		- General code clean-up and optimisation throughout
##
##	2007-06-11 - Version 9.0.0 [RC2]
##		- Prevented an incorrect "successfully deleted" message showing when remove link is a directory
##		- Files deleted via notification link now update database entry if message logging is active
##
##	2007-06-01 - Version 9.0.0 [RC1]
##		- Released with all supported languages updates provided - thanks again to all translators
##		- CSDiff generated changelog between 8.9.7 and 9.0.0 provided
##
##	2007-05-27 - Version 8.9.8 [Beta 3]
##		- Character counter written to only appear when Javascript is not disabled, otherwise its pointless
##		- Bug Fix in Recipients List addon install.txt - Thanks Wolfgang
##
##	2007-05-27 - Version 8.9.8 [Beta 2]
##		- Tweaks to new language entries
##		- Fix issue when senders e-mail is not required, left blank, and "Thank You" e-mail is to be sent
##		- Fix also prevents storing "Not Specified" in email table
##
##	2007-05-26 - Version 8.9.8 [Beta]
##		- Newly developed "Thank You" integration, with extended anti-spam code
##
##	2007-05-15 - Version 8.9.7
##		- Readded missing index.html's in /images/captcha/ and /fonts/ directories
##		- Addition to prevent stretching of the Message Log when long strings entered
##		  - Based on "50 characters in message" mod by "Underhill"
##		  - Set to 30 chars, tested okay on 1024px screen width
##		- Tweaks to improve Message Log template when empty
##
##	2007-05-11 - Version 8.9.6
##		- Various code tweaks
##		- Replaced individual delete links with "tick and submit" method for mass deletion of message logs
##		- phpBB footer/copyright now displayed in full messages (popup) screen
##		- Renamed the Quick $lang['Delete'] to prevent clashing with lang_main.php version
##
##	2007-05-09 - Version 8.9.5
##		- Bug fix to escape messages with single quotes
##		- New: Message Log improved with 100 character limit preview and [more] link to view full message
##		  - Javascript popup style view (best) and disabled script based code
##
##	2007-04-22 - Version 8.9.4
##		- Coding improvements following some testing under error_reporting (E_ALL) conditions
##		- Fixed dumb variable - Admins chosen language was probably not being used, if different from default
##		- Extra extensions added to blacklist mainly to prevent Windows executable viruses being uploaded
##		- Add-ons updated to match all the latest code changes
##
##	2007-04-15 - Version 8.9.3
##		- New Add-on that sends a Thank You e-mail and copy of their feedback to sender (see contrib/addons)
##
##	2007-04-04 - Version 8.9.2
##		- Added basename() to $attachment variable for additional security in handling uploads
##		- Added non-Javascript support to 'back' ability when an error occurs in sending the form
##
##	2007-03-30 - Version 8.9.1 (not released)
##		- Added <label for="id"> tags to main template input fields to improve user accessibility
##
##	2007-03-28 - Version 8.9.0
##		- Bug Fix: Delete link did not appear in notifications when Filename Hashing set to 'No Hash'
##		- $server_protocol being declared too late - moved earlier in script to make safer
##		- Applied use of $server_port was it was not actually in use (its not really that important)
##
##	2007-03-18 - Version 8.8.0
##		- New CAPTCHA set - "icecream" - a pale pink and cream set of images for optional use
##		- Globalised HTTP_POST_FILES in error_check() function incase files were not being removed correctly
##		- Fixed an escape typo in the Italian translation that might cause an error in the ACP screen
##
##	2007-03-09 - Version 8.7.0
##		- French translation now avaliable, courtesy of "Ram" at phpbb-fr.com forums
##
##	2007-03-08 - Version 8.6.0
##		- Message Log addon (from 8.4.0) has been fully integrated into the mod and removed from contrib
##		  -- This option is ON by default, and can be deactivated in the ACP
##		- IP's now use the phpBB decode_ip/encode_ip functions (SQL tables updated)
##		- Fixed an SQL bug in install.txt but not present in db_update.php
##		- Added new info in ACP screen regarding the Admin e-mail address field
##
##	2007-03-03 - Version 8.5.0
##		- New Add-on for the Contact Form that allows Admin to setup a Recipient list (see contrib/addons)
##
##	2007-03-01 - Version 8.4.1
##		- Message Log Addon now includes pagination for the ACP Message Log screen
##		- Tweaks to Reasons Addon install.txt
##
##	2007-02-22 - Version 8.4.0
##		- New Add-on for the Contact Form that also saves messages to the database (see contrib/addons)
##		Changes:
##		  -- Applied stripslashes() to form fields
##		  -- Added 2007 to the copyright info in ACP footer
##
##	2007-02-20 - Version 8.3.0
##		- New Add-on for the Contact Form that allows Admin to setup Reason options (see contrib/addons)
##		Changes:
##		  -- Minor fix to email settings
##
##	2007-02-20 - Version 8.2.0
##		Changes:
##		  -- Tweaks to CAPTCHA
##
##	2007-02-18 - Version 8.1.0
##		- Readded "Admin E-mail Address" option so that Admin can set a different recipient address
##		  -- If left empty e-mails will go to the Admin E-Mail Address set in General Configuration
##		- contrib includes update checker for eXtreme Styles
##
##	2007-02-09 - Version 8.0.0
##		- Added a new TTF - OregonDry
##		- Submitted to phpbb.com ModDB
##
##	2007-02-08 - Version 7.0.0 [RC4]
##		- If the Admin disables "Quick Delete" then a deletion link will no longer appear in their e-mails
##			rather than saying "None Specified"
##		- CAPTCHA improvements:
##		  -- TTF's are randomly mixed together per CAPTCHA load
##		  -- Characters now rotate randomly clockwise and anti-clockwise
##		  -- Font size randomly determined per CAPTCHA load (TTF's only)
##		  -- CAPTCHA length now 5 chars long max as rotation takes up more space
##		  -- Number of lines scribbled on Coloured CAPTCHA randomly determined per CAPTCHA load
##		  -- Re-coded into faster loops and a function based text output
##
##	2007-02-08 - Version 7.0.0 [RC3]
##		- Security fixes re-coded into a loop rather than having two seperate statements
##
##	2007-02-07 - Version 7.0.0 [RC2]
##		- Security Fix: prevents path traversing to delete site owners files
##		- Security Fix: to prevent index.html's being removed from directories thus exposing files
##
##	2007-02-06 - Version 7.0.0 [RC1]
##		- Admin may now "Quick Delete" an Attachment via a link given in the e-mail they receive
##		  -- Note: This deletes uploaded files but not the users directory which needs to be removed later,
##			it is simply an option added for convenience, perhaps if FTP is unavailable at the time
##		  -- This function can also be disabled in ACP should the Admin prefer not to have this option
##
##	2006-12-29 - Version 6.0.0
##		- Submitted to phpbb.com ModDB
##
##	2006-12-26 - Version 5.0.0 [RC13]
##		- Added check to see if Captcha session is set
##		- Adjusted session_start() positions
##		- Fixes made to templates span tags
##
##	2006-12-24 - Version 5.0.0 [RC12]
##		- Tested on phpBB 2.0.22 - everything checks out okay
##		Changes:
##		  -- German translation edited further
##
##	2006-12-23 - Version 5.0.0 [RC11]
##		Changes:
##		  -- PHP5 compatible regardless of any register_globals/register_long_arrays settings
##
##	2006-12-22 - Version 5.0.0 [RC10]
##		- Corrected typo in Admin files preventing a sub-heading from showing
##		- Extended and Improved Error handing:
##		  -- Files that exceeded php.ini before would be deleted by the server which then reported back
##			a 'dud file' (zero size) but now reports back as being "Too big" to prevent confusion
##		  -- Accounted for partial uploads with "Upload failed" error as they too get deleted by server
##		  -- Accounted for possibility of server missing a temp folder with a general "Upload failed"
##		Changes:
##		  -- php.ini 'upload_max_filesize' value displayed in ACP next to "Max File Size" explaination
##
##	2006-12-21 - Version 5.0.0 [RC9]
##		- CAPTCHA script will now check if a server has Freetype Support, and if not will automatically use
##			the PHP standard font to display the code, rather than the Admin having to uncomment it
##		Changes:
##		  -- Edit: "define('PAGE_CONTACT_FORM', -1405);" as this new value is now one of my Reserved Constants
##		  -- Language updated in lang_dutch.php (added into RC8 on 2006-12-21)
##		  -- Language updated in lang_german.php (added into RC8 on 2006-12-20)
##
##	2006-12-20 - Version 5.0.0 [RC8]
##		- PhotoShopped a couple of alternative CAPTCHA image sets for use on sites (see contrib)
##		- Added a box above the Contact Form which explains its generic purpose to Guests
##		Changes:
##		  -- CAPTCHA image size is now 80x25 - was originally 79x22
##		  -- Relocated session calls to try to resolve what may be a PHP5 compatability issue
##		  -- Fixed typo in overall_header.tpl edit relating to the "alt" atribute
##		  -- Applied Submit/Reset buttons as $lang keys, rather than hardcoded values
##		     + Thanks to IPB_Refugee (Wolfgang) for pointing this one out
##		  -- Edits to Dutch language translation
##		  -- Edits to German language translation
##
##	2006-12-18 - Version 5.0.0 [RC7]
##		Changes:
##		  -- CAPTCHA now uses TTF's to display the code, with three randomly switched fonts used
##		  -- Fixed single quote chars in lang_dutch.php (added into RC6 on 2006-12-16)
##		  -- Fixed use of some Caps in lang_german.php (added into RC6 on 2006-12-17)
##
##	2006-12-15 - Version 5.0.0 [RC6]
##		Changes:
##		  -- Substitute any zeros in CAPTCHA to prevent confusion between '0' and 'O' characters
##		  -- Readded mt_srand() seeding to CAPTCHA (now I understand its application properly)
##		  -- Minor tweaks to contact_captcha.php, tidy-up code, reorder headers, etc
##		  -- Removed a duplicate $send_time declaration from contact.php
##
##	2006-12-13 - Version 5.0.0 [RC5]
##		- Added an option for Admin to enable/disable the Form to everyone, as this has practical benefits
##		  -- If you're going away, for example, and don't want to receive a lot of e-mails in the interim
##		  -- If you find a security issue and want to disable, rather than uninstall the mod until updated
##		- A new/improved db_update.php has been added using the phpBB Group SQL Parser (Area 51)
##		- The contrib folder includes:
##		  -- 4 translations of the mod
##		     + Dutch, German, Italian and Spanish
##		  -- A tiny mod to change the Admin e-mail link above the Registration CAPTCHA to the Contact Form
##		Changes:
##		  -- Session data destroyed after each 'submit' so that session and image cannot be reused
##		     + Some browsers (Opera) could 'submit', then go back one and reuse the same image from
##			before, as it does not check cache expiration when using History (RFC 2616, section 13.13)
##
##	2006-12-08 - Version 5.0.0 [RC4]
##		Changes:
##		  -- Added tabindex="-1" to the characters used readout box so that it is skipped
##		  -- Coloured CAPTCHA image now bordered when drawn to neaten it a little (cosmetic)
##		  -- Various tweaks to the main contact_body.tpl, due to minor XHTML impefections
##		  -- Fixed session_start() errors
##		  -- Added a link to phoBBia.net in ACP Copyright by clicking on my name
##		  -- Some minor language changes
##
##	2006-12-07 - Version 5.0.0 [RC3]
##		Changes:
##		  -- Fixed a bug in resetting $type if script fails to find PNG images
##		  -- Fixed "attachment was successfully uploaded" message always displaying
##		  -- Changed "Plain" to "Image based" which requires 5 images to function
##		     + Created a batch of 5 images with oily backgrounds that are randomly picked
##		     + See contrib for the source image I made in Photoshop to easily create these
##
##	2006-12-07 - Version 5.0.0 [RC2]
##		Changes:
##		  -- Added a CAPTCHA to the form, to reduce spambot abuse (See Author Notes)
##		     + PNG image used, as GIF is unsupported between GD 1.6 and 2.0.28
##		     + Captcha is Enabled and Plain image type is default when installed
##
##	2006-12-05 - Version 5.0.0 [RC1]
##		Changes:
##		  -- Changed Random Hash back to rand() function due to issues with srand()
##		  -- Security check, to prevent XSS issues
##		  -- Now a 5 stage error check process:
##		     + Stage 1: Checks Name, E-mail and Comments fields
##		     + Stage 2: Checks Attachment Extensions
##		     + Stage 3: Checks Attachment Size
##		     + Stage 4: Checks Attached Images
##		     + Stage 5: Checks Attachment Upload success
##		  -- If user tries to send one of the following image types, a "zip" request is given
##		     + BMP, PSD (PhotoShop), SWF (Flash), TIFF
##		  -- Replaced all superglobals in Admin file also with $HTTP_* versions
##
##	2006-12-04 - Version 4.9.0
##		Changes:
##		  -- Replaced Random Hash (rand) with Seeded Random Hash (srand) function
##		  -- Replaced all superglobals with $HTTP_* versions for compatability
##		     + Also because phpBB don't approve of these - though I disagree with this
##		  -- Replaced error checking with a Stage based function
##		     + Stage 1: Checks Name, E-mail and Comments fields
##		     + Stage 2: Checks Attachment Extensions
##		     + Stage 3: Checks Attachment Size
##		     + Stage 4: Checks Attachment Upload success
##
##	2006-12-04 - Version 4.8.2 (not released)
##		Changes:
##		  -- Improved Flood Limit explanation for displaying of "hour" or "hours" (plural)
##		  -- Flood Limit explanation does not display if disabled now, instead of "0 hours"
##		     + If Flood Limit is disabled this stops people realising there should be one and abusing it
##
##	2006-12-04 - Version 4.8.0
##		Changes:
##		  -- Moved copyright into ACP page from below main form
##		  -- Added character counter below "message" textarea
##		     + Tested successfully with MSIE 7.0, Firefox 2.0, Opera 9.1b
##
##	2006-12-02 - Version 4.7.0
##		Changes:
##		  -- Added standard "mysite.com Index » Contact Form" breadcrumbs atop template
##		  -- Re-ordered several blocks of coding to improve file handling
##		  -- Fixed some attachment upload issues
##
##	2006-12-01 - Version 4.6.0
##		Changes:
##		  -- Added a "back" option on error messages to allow user to edit and resubmit form
##		     + Javascript based so that fields contain previous text
##		     + Tested successfully with MSIE 7.0, Firefox 2.0, Opera 9.1b
##
##	2006-12-01 - Version 4.5.1
##		- Fixed - form submitting blank fields
##
##	2006-12-01 - Version 4.5.0
##		Changes:
##		  -- Added permission system for limiting who may upload files
##		     + Guests, Members, Moderators, Admins
##
##	2006-11-28 - Version 4.4.0
##		Changes:
##		  -- Tweaked install.txt to improve EasyMod compatibility
##		     + Thanks to "Kiltedknite" for pointing EM issues out
##
##	2006-11-27 - Version 4.3.0
##		Changes:
##		  -- Added ability for Admin to set a maximum length for comments
##		     + Default is 255 upon installation
##		  -- Improved security throughout
##		  -- Fix missing "Hash" title in ACP
##		  -- Various code tweaks
##
##	2006-11-26 - Version 4.2.0
##		Changes:
##		  -- Improved SQL query compatibility (removed MyISAM)
##		  -- Improved XHTML compatibility of Contact Form template
##		  -- Applied htmlspecialchars() to form entry fields
##
##	2006-11-25 - Version 4.1.0
##		- Fixed bug in db_update.php and SQL query
##
##	2006-11-24 - Version 4.0.0
##		- Fixed attachment issue - "filetype()" error
##		Changes:
##		  -- Minor code tweaks
##
##	2006-11-22 - Version 3.0.0
##		Changes:
##		  -- Extra security: user directory has an index.html written into it to prevent browsing
##		     + If main attachment dir needs to be created it also has an "index.html" written into it
##		  -- Security fixes
##		     + Removed lang setting as $board_config was not sanitized and is not needed at this point
##		     + Additional security and error handling for POST issues (and for halting possible attacks)
##		  -- Adjusted code to create attachment dir as defined in ACP, not hardcoded as "efiles"
##
##	2006-11-21 - Version 2.9.0
##		Changes:
##		  -- Link to Contact Form now has its own mini icon (subSilver theme)
##
##	2006-11-20 - Version 2.8.0
##		Changes:
##		  -- Convert filenames and extensions into lowercase (else they get denied)
##
##	2006-11-18 - Version 2.7.0
##		- Rewrote db_update.php - generated errors on installation
##		Changes: None
##
##	2006-11-17 - Version 2.6.5 (not released)
##		- Various minor code tweaks to optimise performance
##		Changes:
##		  -- Added Subject/Charset to the email template
##		  -- Changed Subject to "Feedback received" from "Comments"
##
##	2006-11-16 - Version 2.6.1 (not released)
##		Changes:
##		  -- Very minor language change
##
##	2006-11-15 - Version 2.6.0
##		Changes:
##		  -- Added option to hash the filename of uploads using random MD5 method
##		     + MD5 method set as default
##		  -- Edited language file with a clearer message for duplicate upload
##
##	2006-11-14 - Version 2.5.0
##		- Fixed issue after script checks white/blacklist then cannot proceed to upload
##		- Fixed filesize check accuracy (1024bytes in a Kb, not 1000bytes as was initially coded)
##		Changes:
##		  -- Replaced "copy()" with "move_uploaded_file()" function for increased security
##		  -- Removed some unnecessary code from main Contact Form template
##		  -- Minor code tweaks and language edits
##
##	2006-11-12 - Version 2.4.0
##		Changes:
##		  -- Added a whitelist for permitted extensions, checked after blacklisted extensions
##		  -- Added "zip the file" suggestion to refused uploads, and files that are too large
##		  -- Extended blacklist array, additional extensions added
##		  -- Updated Authors Notes
##
##	2006-11-07 - Version 2.3.0
##		Changes:
##		  -- Changed SQL fieldname "time" as it is a reserved word (SQL-99 Standards)
##		  -- Changed "send_time" from VARCHAR(100) to INT(11)
##		  -- Added "zero" flood time ability to allow for testing of the mod once installed
##		  -- Version added to config table, displays in ACP header
##
##	2006-10-13 - Version 2.2.0
##		Changes:
##		  -- Replaced all long predefined arrays with superglobals:
##		     + Accounted for possible use of PHP versions lower than 4.1.0
##		     + Fixed a mistyped $HTTP_FILES_POST variable due to change
##		  -- Added security to prevent possible Local Inclusion Vulnerability
##		  -- Corrected confirmation of a successful attachment upload
##
##	2006-10-08 - Version 2.1.0
##		- Discovered that the e-mail ALWAYS goes to $board_config['board_email'] so
##		  tried changing this to the $contact_config['contact_send_mail'] which then
##		  only results in emailer.php ::PHP:: errors and does not submit the form!
##		Changes:
##		  -- Removed code for seperate e-mail for Contact Form
##
##	2006-10-06 - Version 2.0.0		
##		Changes:
##		  -- Added extension security, potentially malicious files cannot be uploaded!
##		  -- Added check and error message for 'dud' attachments (zero filesize)
##		  -- Added Admin note that Max File Size cannot exceed php.ini setting
##		  -- Changed all "require" to "include" for standard phpbb mod coding
##		  -- Edited some lang entries slightly
##		  -- Fixed incorrect variable for empty comments field
##		  -- General errors are now checked and displayed before the e-mail is prepared
##		  -- Reordered check to see if the attachment already exists
##
##	2006-09-17 - Version 1.0.0
##		- Mod ownership transferred to Marcus for continuation and development
##
##		Changes:
##		  -- Added a "Permit Attachment" switch to allow Admin to prevent any
##			attachments, if they are not willing
##		  -- Added extra ACP online information as mod is for Guests also
##		  -- Added version number beside the ACP header
##		  -- Altered SQL queries for the various changes to the mod
##		  -- Edited a lang issue with e-mail explaination coming from lang_main.php
##		  -- Edited a couple of the original lang descriptions and corrected some typos
##		  -- Fixed 'Kb' and 'Hours' display in explainations and general
##			errors from hard coded to true values
##		  -- Fixed issue with spaces in filenames using "urlencode()" which prevents
##			unbroken links in the e-mail to Admin
##		  -- Fixed missing empty email field error check
##		  -- Included a "db_update.php" file for sql query installation
##		  -- Moved Contact Table define code into constants.php along with new table
##		  -- Move form data into its own contact_config table for future development
##		  -- Prevented error reports for mkdir operation during upload of attachments
##		  -- Redesigned and reordered template layout - moved copyright footer
##			from the Admins e-mails to bottom of the form itself
##		  -- Renamed attachment directory as /efiles to prevent files getting
##			mixed with posted File Attachments in /files if that mod is installed
##		  -- Renamed mod from "Contact Us" to "Contact Form" for broader potential
##		  -- Removed the "Language" option and functions, not deemed necessary
##		  -- Removed the "Require Attachment" - why force an attachment if the
##			visitor just wishes to comment?
##		  -- Removed unrequired cookie config code from admin file
##		  -- Reordered Flood Control code to check for early submission BEFORE sending
##			an e-mail to the Admin / uploading attachments and then displaying error
##		  -- Reordered multiple errors to display in the same order as the form fields
##		  -- Replaced e-mail regex with phpbb's preg_match validation function
##			(inc umlauts for German e-mail addresses to be validated)
##
## Previous MOD History:
##
##	2006-09-17 - Version 0.9.0
##		- Abandoned
##
##	2005-09-12 - Version 0.8.0
##		- Added ACP Page
##			+ Ability to change requirements
##			+ Ability to change options like flood limit and the email
##			address to send the email to
##		- Re-added the language option
##
##	2005-05-15 - Version 0.7.0
##		- Added Flood Interval (yeah!)
##		- Created improved error system
##
##	2005-04-21 - Version 0.6.0
##		- Added specific error-messages so they know what they did wrong.
##		- Re-did the code, though not enough was changed to advance the version to "0.1.0.0".
##		- The limit on the size of attachment is functional at 64000 bytes (64kb).
##		- If attachment name exists, sends error message.
##
##	2005-04-16 - Version 0.5.2
##		- Cleaned up all references to the textbox "Username" in contact.php
##		- Removed all references to the textbox "Username" in lang_contact.php
##
##	2005-04-11 - Version 0.5.0
##		- Email validator if applicable
##
##	2005-04-10 - Version 0.4.0
##		- Attachments completed
##		- Fixed $lang bug (Thx to carlcox89)
##
##	2005-04-09 - Version 0.3.1
##		- Attachments finished
##
##	2005-04-08 - Version 0.3.0
##		- Language option removed
##		- In email, tells whether or not a field is empty
##		- Added Real name and Email
##
##	2005-04-07 - Version 0.2.1
##		- Attachment support added
##		- Fixed problem of sending mail
##
##	2005-04-03 - Version 0.1.0
##		- Initial release of "Contact Us" Mod
## 
############################################################## 
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD 
############################################################## 

#
#-----[ DIY INSTRUCTIONS ]-------------------------------------------
#
CHMOD "efiles" to 777 to allow for Attachments to upload correctly.

Run the following SQL queries in phpMyAdmin [OR] use the db_update.php - delete it once executed!
Run db_update.php if upgrading the version, though you may need to reconfigure your form afterwards.

#
#-----[ SQL ]-------------------------------------------
#
CREATE TABLE `phpbb_contact` (
  `ip_address` char(8) NOT NULL default '',
  `send_time` int(11) NOT NULL default '0',
  KEY `ip_address` (`ip_address`)
);

CREATE TABLE `phpbb_contact_config` (
  `config_name` varchar(255) NOT NULL default '',
  `config_value` varchar(255) NOT NULL default '',
  PRIMARY KEY (`config_name`)
);

CREATE TABLE `phpbb_contact_msgs` (
  `msg_id` int(3) UNSIGNED NOT NULL auto_increment,
  `sendtime` int(11) NOT NULL default '0',
  `username` varchar(25) NOT NULL default '',
  `realname` varchar(30) NOT NULL default '',
  `email` varchar(50) NOT NULL default '',
  `ip` char(8) NOT NULL default '',
  `message` text NOT NULL,
  `upfile` varchar(255) NOT NULL default '',
  PRIMARY KEY (`msg_id`)
);

CREATE TABLE `phpbb_contact_emails` (
  `email` varchar(50) NOT NULL default '',
  `sent` int(1) NOT NULL default '0',
  `lasttime` int(11) NOT NULL default '0',
  PRIMARY KEY (`email`)
);

INSERT INTO `phpbb_contact_config` VALUES ('contact_version', '9.0.0');
INSERT INTO `phpbb_contact_config` VALUES ('contact_admin_email', '');
INSERT INTO `phpbb_contact_config` VALUES ('contact_form_enable', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_require_rname', '0');
INSERT INTO `phpbb_contact_config` VALUES ('contact_require_email', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_require_comments', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_permit_attachments', '0');
INSERT INTO `phpbb_contact_config` VALUES ('contact_max_file_size', '128');
INSERT INTO `phpbb_contact_config` VALUES ('contact_file_root', 'efiles');
INSERT INTO `phpbb_contact_config` VALUES ('contact_flood_limit', '8');
INSERT INTO `phpbb_contact_config` VALUES ('contact_char_limit', '255');
INSERT INTO `phpbb_contact_config` VALUES ('contact_prune', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_hash', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_auth_guest', '0');
INSERT INTO `phpbb_contact_config` VALUES ('contact_auth_user', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_auth_mod', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_auth_admin', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_captcha', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_captcha_type', '0');
INSERT INTO `phpbb_contact_config` VALUES ('contact_delete', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_storage', '1');
INSERT INTO `phpbb_contact_config` VALUES ('contact_thankyou', '1');

#
#-----[ COPY ]------------------------------------------ 
# 
copy root/*.* to *.*

# 
#-----[ OPEN ]------------------------------------------ 
# 
viewonline.php
#
#-----[ FIND ]------------------------------------------ 
#
				case PAGE_FAQ:
					$location = $lang['Viewing_FAQ'];
					$location_url = "faq.$phpEx";
					break;
#
#-----[ AFTER, ADD ]------------------------------------
#
				case PAGE_CONTACT_FORM:
					$location = $lang['Viewing_contact_form'];
					$location_url = "contact.$phpEx";
					break;
#
#-----[ OPEN ]------------------------------------------
#
includes/page_header.php
#
#-----[ FIND ]-----------------------------------------
#
	'L_WHOSONLINE_MOD' => sprintf($lang['Mod_online_color'], '<span style="color:#' . $theme['fontcolor2'] . '">', '</span>'),
#
#-----[ AFTER, ADD ]------------------------------------
#
	'L_CONTACT_FORM' => $lang['Contact_form'],
#
#-----[ FIND ]------------------------------------------
#
	'U_GROUP_CP' => append_sid('groupcp.'.$phpEx),
#
#-----[ AFTER, ADD ]-----------------------------------
#
	'U_CONTACT_FORM' => append_sid('contact.'.$phpEx),
#
#-----[ OPEN ]------------------------------------------
#
includes/constants.php
#
#-----[ FIND ]------------------------------------------
#
define('PAGE_GROUPCP', -11);
#
#-----[ AFTER, ADD ]------------------------------------
#
#
define('PAGE_CONTACT_FORM', -1405);
#
#-----[ FIND ]------------------------------------------
#
define('CONFIG_TABLE', $table_prefix.'config');
#
#-----[ AFTER, ADD ]------------------------------------
#
define('CONTACT_TABLE', $table_prefix . 'contact');
define('CONTACT_CONFIG_TABLE', $table_prefix . 'contact_config');
define('CONTACT_MSGS_TABLE', $table_prefix . 'contact_msgs');
define('CONTACT_EMAILS_TABLE', $table_prefix . 'contact_emails');
#
#-----[ OPEN ]------------------------------------------
#
admin/index.php
#
#-----[ FIND ]------------------------------------------
#
						case PAGE_FAQ:
							$location = $lang['Viewing_FAQ'];
							$location_url = "index.$phpEx?pane=right";
							break;
#
#-----[ AFTER, ADD ]------------------------------------
#
						case PAGE_CONTACT_FORM:
							$location = $lang['Viewing_contact_form'];
							$location_url = "contact.$phpEx?pane=right";
							break;
#
#-----[ FIND ]------------------------------------------
#
					case PAGE_FAQ:
						$location = $lang['Viewing_FAQ'];
						$location_url = "index.$phpEx?pane=right";
						break;
#
#-----[ AFTER, ADD ]------------------------------------
#
					case PAGE_CONTACT_FORM:
						$location = $lang['Viewing_contact_form'];
						$location_url = "contact.$phpEx?pane=right";
						break;
#
#-----[ OPEN ]------------------------------------------
#
language/lang_english/lang_main.php
#
#-----[ FIND ]------------------------------------------
#
//
// That's all, Folks!
// -------------------------------------------------
#
#-----[ BEFORE, ADD ]----------------------------------
#
//
// Contact Form
//
$lang['Viewing_contact_form'] = 'Using Contact Form';
$lang['Contact_form'] = 'Contact Form';

#
#-----[ OPEN ]------------------------------------------
#
templates/subSilver/overall_header.tpl
#
#-----[ FIND ]------------------------------------------
#
<a href="{U_GROUP_CP}" class="mainmenu"><img src="templates/subSilver/images/icon_mini_groups.gif" width="12" height="13" border="0" alt="{L_USERGROUPS}" hspace="3" />{L_USERGROUPS}</a>&nbsp;
#
#-----[ IN-LINE FIND ]---------------------------------
#
&nbsp;
#
#-----[ IN-LINE AFTER, ADD ]----------------------------
#
 &nbsp;<a href="{U_CONTACT_FORM}" class="mainmenu"><img src="templates/subSilver/images/icon_mini_contact.gif" width="12" height="13" border="0" alt="{L_CONTACT_FORM}" hspace="3" />{L_CONTACT_FORM}</a>&nbsp;

#
#-----[ SAVE/CLOSE ALL FILES ]--------------------------
#
# EoM